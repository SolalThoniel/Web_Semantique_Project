
<!DOCTYPE html>

<html lang="fr">
    <head>
        <title>Comics Search</title>
        <link rel="stylesheet" href="../css/Resultats.css">
        <meta charset="utf-8" />
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    </head > <!-- fin de la 1ère partie : l'entête (les réglages) -->
 
    <body>
	<a href="Accueil.html"><img id="logo" src="../Images/manga-logo.jpg"/></a>
	
	<section class="zone-de-texte" >
		<input type="text" id="motCle" name="motCle" size="50" placeholder="Search a comic book here !" autocomplete="on" />
		<input type="button" value="rechercher" onclick="rechercheTitre(0)"/>
	</section>
	
	<h1> Resultats de la recherche </h1>
		
    <ul id="liste_resultats"></ul>
    
    
	<script>
	    
		function getParameterByName(name, url) {
			if (!url) url = window.location.href;
			name = name.replace(/[\[\]]/g, '\\$&');
			var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
					results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			return decodeURIComponent(results[2].replace(/\+/g, ' '));
		}
		
		var motCleGet = getParameterByName('motCle');
		document.getElementById("motCle").value = motCleGet;
		
		function rechercheTitre (premiere) {
			if(premiere === 0){
				document.getElementById("liste_resultats").innerHTML = "";
			}
			var motsCles = document.getElementById("motCle").value;
			//var query = encodeURIComponent(  'Select ?c where{ ?c  rdf:type dbo:Comic.  ?c rdfs:label ?label. Filter(contains(?label, "'+motsCles+'")) }');
			var query = encodeURIComponent(  'Select distinct ?c ?name where{ ?c  rdf:type dbo:Manga, dbo:Comic. ?c dbp:name ?name. ?c dbp:jaRomaji ?romaji. ?c dbp:jaKanji ?kanji. MINUS {?c dct:subject dbc:Visual_novels.} MINUS {?c rdf:type dbo:Film.} MINUS {?c dbo:type dbr:Light_novel.} filter (contains(lcase(str(?name)),lcase("'+motsCles+'")) || contains(lcase(str(?romaji)),lcase("'+motsCles+'")) || contains(str(?kanji),"'+motsCles+'") )}');
			var url = 'http://dbpedia.org/sparql?default-graph-uri=http%3A%2F%2Fdbpedia.org&query='+ query +'&output=json';
			$.getJSON(url+"&callback=?", function(resultats) {
			var size = resultats.results.bindings.length;
			if(size == 0) document.getElementById("liste_resultats").innerHTML = "Desole nous n'avons rien trouve"; 
				$(resultats.results.bindings).each(function(i) {
					 
					//document.getElementById("paragraphe").innerHTML = resultats.results.bindings[i].c.value ;
					str = JSON.stringify(resultats.results.bindings );
					console.log(str);
					
					var ligne = document.createElement("li"); // Create a <li> node
					 
					
					var contenu_ligne = "<p id='paragraphe_resultat"+i+"' onclick='navigationPageInfosManga(\""+resultats.results.bindings[i].c.value+"\")'>"+resultats.results.bindings[i].name.value+"  </p>";
					
					ligne.innerHTML = contenu_ligne;
					
					document.getElementById("liste_resultats").appendChild(ligne); // Append <li> to <ul> with id="liste_resultats" 
					
				});
			});
		}
		
		rechercheTitre(1);
	
		function navigationPageInfosManga(lien) {
		
			console.log("click sur : "+lien);
			
			var url = window.location.href;
			
			var url2 = url.substr(0, url.indexOf("Resultats.html"));
			
			var url3 = url2 + "InfosManga.html?lien=" + lien;
			console.log(url3);
			
			window.location.href = url3;
			
		}
		
		
  	</script>

    </body> <!-- fin de la 2e partie : le corps (la partie visible) -->
</html>
